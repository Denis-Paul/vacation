<div class="container">
    <h1><b>VacationPlanr</b></h1>
    <br>
    <h4>Welcome to <b>VacationPlanr</b> application</h4>
    <p>This is the best place where you can find your next vacation destination</p>

    <% if user_signed_in? %>
        <p>Logged in as: <b> <%= current_user.email %> </b> </p>
        <br>
        <h3>Available destinations</h3>

        <table class="table table-bordered table-hover">
            <thead class="thead-dark">
                <tr>
                    <th scope="col">City</th>
                    <th scope="col">Country</th>
                    <th scope="col">Currency</th>
                    <th scope="col">Current Weather</th>
                    <th scope="col"></th>
                    <th scope="col"></th>
                    <th scope="col"></th>
                </tr>
            </thead>
            <tbody>
                <% @destinations.each do |destination| %>
                <tr>
                    <td><%= destination.city %></td>
                    <td><%= destination.country %></td>
                    <td><%= destination.currency %></td>
                    <% if destination[:weather][:error].present? %>
                        <td> <i><%= destination[:weather][:error] %></i> </td>
                        <td> - </td>
                        <td> - </td>
                        <td> - </td>
                    <% else %>
                        <td>Temperature: <%= destination[:weather][:data][:temp_c] %> °C</td>
                        <td>Feels like: <%= destination[:weather][:data][:feelslike_c] %> °C</td>
                        <td>Condition: <%= destination[:weather][:data][:condition][:text] %></td>
                        <td><%= button_to 'Add to favorites', favorites_path(id: destination.id), id: 'add_favorite', method: :create, remote: true, class: 'btn btn-primary btn-sm' %></td>
                    <% end %>
                </tr>
                <% end %>
            </tbody>
        </table>
        <br>
        <%= form_tag filter_destinations_path, method: :get do %>
            <%= text_field_tag :country, params[:country], placeholder: 'Filter country', class: 'input-small' %>
            <%= button_tag type: :submit, class: "btn btn-outline-success btn-sm" do %>
                <%= 'Filter' %> 
            <% end %>
        <% end %>
        <br>
        <%= link_to 'Favorites', favorites_path %>
        <br>
        <%= link_to 'Detailed city weather info', weather_index_path, method: :get %>
        <br>
        <%= link_to 'Sign Out', destroy_user_session_path, method: :delete %>
    <% else %>
        <p>Please sign in to get the best of our application</p>
        <%= link_to 'Sign In', new_user_session_path %>
    <% end %>
</div>
